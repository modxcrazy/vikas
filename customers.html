<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EMI Dealer — Customer List</title>
  <script type="module">
    window.firebaseConfig = {
      apiKey: "AIzaSyDxpLuWeigl_jOw-6lB4_0Zqdr_X5mEc3I",
    authDomain: "kspecialtool.firebaseapp.com",
    databaseURL: "https://kspecialtool-default-rtdb.firebaseio.com",
    projectId: "kspecialtool",
    storageBucket: "kspecialtool.appspot.com",
    messagingSenderId: "101775819923",
    appId: "1:101775819923:web:58aeca55fd62104d1cf966",
    measurementId: "G-B8E7Z6L19S"
    };
  </script>
  <style>
    :root{
      --bg:#0e144a;
      --card:#1A237E;
      --muted:#c5cae9;
      --accent:#536dfe;
      --success:#00e676;
      --danger:#ff5252;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:#fff;min-height:100vh;padding:24px}
    .app{max-width:1200px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;margin-bottom:20px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:48px;height:48px;background:var(--accent);border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700}
    .title{font-size:18px;font-weight:600}
    .controls{display:flex;flex-wrap:wrap;gap:10px}
    input,select,button{padding:10px 12px;border-radius:8px;border:none;font-size:14px}
    input,select{background:#283593;color:#fff;outline:none}
    button{background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:14px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.3)}
    .name{font-size:16px;font-weight:700}
    .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    .badge{display:inline-block;padding:4px 8px;border-radius:8px;font-size:12px;font-weight:600;margin-top:4px;background:#303f9f}
    .btnAction{margin-top:10px;padding:6px 10px;font-size:13px;border:none;border-radius:6px;cursor:pointer;font-weight:600}
    .btnLock{background:var(--danger);color:#fff}
    .btnUnlock{background:var(--success);color:#000}
    footer{margin-top:20px;font-size:13px;color:var(--muted)}/* Sweet Alert Style */
.swal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1000}
.swal-box{background:#1A237E;padding:24px;border-radius:12px;max-width:320px;text-align:center;box-shadow:0 0 20px rgba(0,0,0,0.4)}
.swal-title{font-size:18px;font-weight:700;margin-bottom:10px}
.swal-text{font-size:14px;color:var(--muted);margin-bottom:18px}
.swal-buttons{display:flex;justify-content:center;gap:10px}
.swal-btn{padding:8px 14px;border:none;border-radius:8px;font-weight:600;cursor:pointer}
.swal-confirm{background:var(--accent);color:#fff}
.swal-cancel{background:#3949ab;color:#fff}

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">ED</div>
        <div>
          <div class="title">EMI Dealer — Customer List</div>
          <div style="font-size:13px;color:var(--muted)">Realtime Firebase viewer & controls</div>
        </div>
      </div>
      <div class="controls">
        <input id="search" placeholder="Search name or device..." />
        <select id="filterLock">
          <option value="all">All</option>
          <option value="locked">Locked</option>
          <option value="unlocked">Unlocked</option>
        </select>
      </div>
    </header><div id="list" class="grid"></div>

<footer>Replace firebaseConfig with your credentials. Only authorized dealers should have access.</footer>

  </div>  <!-- Sweet Alert Modal -->  <div id="swalBackdrop" class="swal-backdrop">
    <div class="swal-box">
      <div class="swal-title" id="swalTitle"></div>
      <div class="swal-text" id="swalText"></div>
      <div class="swal-buttons">
        <button class="swal-btn swal-cancel" id="swalCancel">Cancel</button>
        <button class="swal-btn swal-confirm" id="swalConfirm">Confirm</button>
      </div>
    </div>
  </div>  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getDatabase, ref, onValue, update } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js';

    const app = initializeApp(window.firebaseConfig);
    const db = getDatabase(app);

    const listEl = document.getElementById('list');
    const searchEl = document.getElementById('search');
    const filterLock = document.getElementById('filterLock');

    const swalBackdrop = document.getElementById('swalBackdrop');
    const swalTitle = document.getElementById('swalTitle');
    const swalText = document.getElementById('swalText');
    const swalConfirm = document.getElementById('swalConfirm');
    const swalCancel = document.getElementById('swalCancel');

    let rawData = {};
    let pendingAction = null;

    function render(data){
      rawData = data || {};
      const q = searchEl.value.toLowerCase();
      const filter = filterLock.value;
      listEl.innerHTML = '';
      Object.keys(data).forEach(uid => {
        const u = data[uid];
        if(filter!=='all' && u.lock_status!==filter) return;
        if(q && !(u.name?.toLowerCase().includes(q)||u.device?.toLowerCase().includes(q))) return;
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML=`
          <div class='name'>${escapeHtml(u.name||'—')}</div>
          <div class='meta'>${escapeHtml(u.device||'—')}</div>
          <div class='meta'>IMEI1: ${escapeHtml(u.IMEI1||'—')}</div>
          <div class='meta'>IMEI2: ${escapeHtml(u.IMEI2||'—')}</div>
          <div class='meta'>Number: ${escapeHtml(u.number||'—')}</div>
          <div class='badge'>${escapeHtml(u.lock_status||'—')}</div>
          <button class='btnAction ${u.lock_status==='locked'?'btnUnlock':'btnLock'}' data-uid='${uid}'>${u.lock_status==='locked'?'Unlock':'Lock'}</button>
        `;
        listEl.appendChild(card);
      });
      document.querySelectorAll('.btnAction').forEach(btn=>{
        btn.addEventListener('click',()=>confirmToggle(btn.dataset.uid));
      });
    }

    function confirmToggle(uid){
      const user = rawData[uid];
      if(!user) return;
      const newStatus = user.lock_status==='locked'?'unlocked':'locked';
      swalTitle.textContent = newStatus==='locked'?'Lock Device?':'Unlock Device?';
      swalText.textContent = `Are you sure you want to ${newStatus} this device (Name: ${user.name})?`;
      swalBackdrop.style.display='flex';
      pendingAction = ()=>{
        update(ref(db,'EMI_All_Users/'+uid),{lock_status:newStatus}).then(()=>{
          swalBackdrop.style.display='none';
          showAlert(`Device ${newStatus} successfully!`);
        }).catch(err=>showAlert('Error: '+err.message));
      };
    }

    swalConfirm.addEventListener('click',()=>{
      if(pendingAction) pendingAction();
    });
    swalCancel.addEventListener('click',()=>{
      swalBackdrop.style.display='none';
    });

    function showAlert(msg){
      swalTitle.textContent='Done';
      swalText.textContent=msg;
      swalCancel.style.display='none';
      swalConfirm.textContent='OK';
      swalBackdrop.style.display='flex';
      swalConfirm.onclick=()=>{
        swalBackdrop.style.display='none';
        swalCancel.style.display='inline-block';
        swalConfirm.textContent='Confirm';
      };
    }

    function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}

    onValue(ref(db,'EMI_All_Users'),snap=>{
      render(snap.val()||{});
    });

    [searchEl,filterLock].forEach(e=>e.addEventListener('input',()=>render(rawData)));
  </script></body>
</html>
