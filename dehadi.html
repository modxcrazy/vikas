<!doctype html>

<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Furniture Kaam Dehadi — Attendance</title>
  <style>
    :root{--bg:#f4f7fb;--card:#ffffff;--muted:#6b7280;--accent:#0ea5a4;--accent-2:#0f172a;--success:#16a34a;--danger:#ef4444;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#eef7f7 0%,var(--bg)100%);color:var(--accent-2)}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .brand{display:flex;gap:14px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:20px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}.grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 30px rgba(16,24,40,0.06)}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef2;background:transparent}
.row{display:flex;gap:10px}
.row > div{flex:1}
.controls{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
button{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(90deg,var(--accent),#06b6d4);color:#fff}
.btn-ghost{background:transparent;border:1px solid #e6eef2;color:var(--accent-2)}
.small{font-size:13px;padding:8px 10px}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px;text-align:left;border-bottom:1px solid #f1f6f8}
th{font-size:12px;color:var(--muted);font-weight:700}
.chip{padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px}
.chip.ok{background:rgba(22,163,74,0.12);color:var(--success)}

.meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:var(--muted);font-size:13px}
.tools{display:flex;gap:8px;align-items:center}
.search{padding:8px 12px;border-radius:10px;border:1px solid #e6eef2}

@media(max-width:960px){.grid{grid-template-columns:1fr}.controls{justify-content:space-between}}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">FK</div>
        <div>
          <h1>Furniture Kaam Dehadi — Attendance</h1>
          <p class="lead">Workers ko pehle register karein. Phir wahi select kar ke attendance add karein. (Local-only)</p>
        </div>
      </div>
      <div class="tools">
        <input id="search" class="search" placeholder="Search name / date / role" />
        <button id="exportCsv" class="small btn-ghost">Export CSV</button>
        <button id="printTable" class="small btn-ghost">Print</button>
      </div>
    </header><div class="grid">
  <!-- Main column: attendance -->
  <div class="card">
    <h3 style="margin:0 0 10px 0">Attendance Lagao</h3>
    <form id="attForm">
      <label>Worker</label>
      <select id="workerSelect"><option value="">-- Select worker --</option></select>

      <div class="row" style="margin-top:10px">
        <div>
          <label>Date</label>
          <input id="attDate" type="date" />
        </div>
        <div>
          <label>Role (auto)</label>
          <input id="attRole" type="text" readonly />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label>Start</label>
          <input id="attStart" type="time" />
        </div>
        <div>
          <label>End</label>
          <input id="attEnd" type="time" />
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <label><input id="attFull" type="checkbox" /> Full day (12 hours)</label>
        <div class="controls">
          <button type="submit" class="btn-primary">Save Attendance</button>
          <button type="button" id="clearAtt" class="btn-ghost">Clear</button>
        </div>
      </div>
    </form>

    <div class="meta"><div>Total entries: <strong id="attCount">0</strong></div><div>Today: <strong id="attToday">0</strong></div></div>

    <div style="margin-top:12px;overflow:auto;max-height:420px">
      <table id="attTable"><thead><tr><th>Worker</th><th>Role</th><th>Date</th><th>Start</th><th>End</th><th>Hrs</th><th></th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <!-- Sidebar: worker management & summary -->
  <div>
    <div class="card" style="margin-bottom:12px">
      <h3 style="margin:0 0 8px 0">Worker Register</h3>
      <form id="workerForm">
        <label>Name</label>
        <input id="wName" type="text" placeholder="Ex: Ram Kumar" />
        <label style="margin-top:10px">Role</label>
        <input id="wRole" type="text" placeholder="Ex: Carpenter" />
        <div class="controls" style="margin-top:10px">
          <button type="submit" class="btn-primary small">Add Worker</button>
          <button type="button" id="clearWorkers" class="btn-ghost small">Clear All Workers</button>
        </div>
      </form>

      <div style="margin-top:12px;max-height:200px;overflow:auto">
        <table id="workersTable"><thead><tr><th>Name</th><th>Role</th><th></th></tr></thead><tbody></tbody></table>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px 0">Summary</h3>
      <p style="margin:6px 0;color:var(--muted)">Total Workers: <strong id="totalWorkers">0</strong></p>
      <p style="margin:6px 0;color:var(--muted)">Total Hours: <strong id="sumHours">0</strong></p>
      <p style="margin:6px 0;color:var(--muted)">Last saved: <strong id="lastSaved">—</strong></p>
    </div>
  </div>
</div>

  </div>  <script>
    // Keys
    const W_KEY = 'fk_workers_v1';
    const A_KEY = 'fk_attendance_v2';

    // Helpers
    const $ = id => document.getElementById(id);
    function load(key){ try{return JSON.parse(localStorage.getItem(key)||'[]')}catch(e){return []} }
    function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); $('lastSaved').textContent = new Date().toLocaleString(); }
    function timeToMin(t){ if(!t) return 0; const [h,m]=t.split(':').map(Number); return h*60+m }
    function minToH(m){ const h = Math.floor(m/60); const mm = m%60; return h + ':' + String(mm).padStart(2,'0') }

    // Init defaults
    document.addEventListener('DOMContentLoaded', ()=>{
      // set today date
      const today = new Date().toISOString().slice(0,10); $('attDate').value = today;
      $('attStart').value='09:00'; $('attEnd').value='21:00';
      renderWorkers(); renderAttendance();

      // Worker form
      $('workerForm').addEventListener('submit', e=>{
        e.preventDefault(); const name = $('wName').value.trim(); const role = $('wRole').value.trim(); if(!name) return alert('Naam daalna zaroori hai');
        const arr = load(W_KEY); arr.push({id: Date.now(), name, role}); save(W_KEY, arr); $('wName').value=''; $('wRole').value=''; renderWorkers();
      });

      $('clearWorkers').addEventListener('click', ()=>{ if(!confirm('Saare workers hata den?')) return; localStorage.removeItem(W_KEY); renderWorkers(); });

      // Attendance form
      $('attForm').addEventListener('submit', e=>{
        e.preventDefault(); const wid = $('workerSelect').value; if(!wid) return alert('Pehle worker select karein');
        const workers = load(W_KEY); const w = workers.find(x=>String(x.id)===wid); if(!w) return alert('Worker mil nahi raha');
        const date = $('attDate').value; const start = $('attStart').value; const end = $('attEnd').value; if(!date||!start||!end) return alert('Date, start aur end chahiye');
        const arr = load(A_KEY); arr.push({id: Date.now(), workerId: w.id, name: w.name, role: w.role, date, start, end}); save(A_KEY,arr); renderAttendance(); clearAttForm();
      });

      $('clearAtt').addEventListener('click', clearAttForm);

      $('attFull').addEventListener('change', e=>{ if(e.target.checked){ $('attStart').value='09:00'; $('attEnd').value='21:00'; } });

      // Export CSV
      $('exportCsv').addEventListener('click', ()=>{
        const rows = load(A_KEY).map(it=>{
          const mins = Math.max(0, timeToMin(it.end)-timeToMin(it.start));
          return [it.name, it.role||'', it.date, it.start, it.end, minToH(mins)];
        });
        if(!rows.length) return alert('Koi attendance record nahi');
        const csv = ['Name,Role,Date,Start,End,Hours', ...rows.map(r=>r.map(c=>`"${String(c).replaceAll('"','""')}").join(',')).join('
')];
        const blob = new Blob([csv.join('
')],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download = `attendance_${new Date().toISOString().slice(0,10)}.csv`; a.click(); URL.revokeObjectURL(url);
      });

      // Search
      $('search').addEventListener('input', e=> renderAttendance(e.target.value.trim().toLowerCase()));

      // Print
      $('printTable').addEventListener('click', ()=> window.print());
    });

    // Render workers
    function renderWorkers(){
      const tbody = document.querySelector('#workersTable tbody'); const sel = $('workerSelect'); tbody.innerHTML=''; sel.innerHTML='<option value="">-- Select worker --</option>';
      const arr = load(W_KEY);
      arr.forEach(w=>{
        const tr = document.createElement('tr'); tr.innerHTML = `<td>${esc(w.name)}</td><td>${esc(w.role||'')}</td><td><button class=\"btn-ghost small\" data-id=\"${w.id}\" onclick=\"deleteWorker(${w.id})\">Delete</button></td>`;
        tbody.appendChild(tr);
        const opt = document.createElement('option'); opt.value = w.id; opt.textContent = w.name + (w.role? ' — '+w.role:''); sel.appendChild(opt);
      });
      $('totalWorkers').textContent = arr.length;
      // when select changes, set role
      sel.addEventListener('change', ()=>{
        const id = sel.value; const found = arr.find(x=>String(x.id)===id); $('attRole').value = found ? found.role : '';
      });
    }

    // delete worker
    function deleteWorker(id){ if(!confirm('Kya aap sure hain?')) return; const arr = load(W_KEY).filter(w=>w.id!==id); save(W_KEY,arr); // also remove attendance of that worker
      const att = load(A_KEY).filter(a=>a.workerId!==id); save(A_KEY,att); renderWorkers(); renderAttendance(); }

    // Render attendance
    function renderAttendance(filter=''){
      const tbody = document.querySelector('#attTable tbody'); tbody.innerHTML='';
      const arr = load(A_KEY);
      let totalMin=0; const today = new Date().toISOString().slice(0,10); let todayCount=0;
      arr.filter(it=>{
        if(!filter) return true;
        return it.name.toLowerCase().includes(filter) || it.date.includes(filter) || (it.role||'').toLowerCase().includes(filter);
      }).forEach(it=>{
        const mins = Math.max(0, timeToMin(it.end)-timeToMin(it.start)); totalMin += mins; if(it.date===today) todayCount++;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${esc(it.name)}</td><td>${esc(it.role||'')}</td><td>${it.date}</td><td>${it.start}</td><td>${it.end}</td><td><span class=\"chip ${mins>=12*60? 'ok':''}\">${minToH(mins)}</span></td><td><button class=\"btn-ghost small\" onclick=\"editAtt(${it.id})\">Edit</button> <button class=\"btn-ghost small\" onclick=\"delAtt(${it.id})\">Delete</button></td>`;
        tbody.appendChild(tr);
      });
      $('attCount').textContent = arr.length; $('attToday').textContent = todayCount; $('sumHours').textContent = (totalMin/60).toFixed(2) + ' hrs';
    }

    // Edit / Delete attendance
    function delAtt(id){ if(!confirm('Delete this entry?')) return; const arr = load(A_KEY).filter(a=>a.id!==id); save(A_KEY,arr); renderAttendance(); }
    function editAtt(id){ const arr = load(A_KEY); const it = arr.find(a=>a.id===id); if(!it) return; // fill form and remove original
      $('workerSelect').value = it.workerId; $('attRole').value = it.role; $('attDate').value = it.date; $('attStart').value = it.start; $('attEnd').value = it.end; // remove
      const newArr = arr.filter(a=>a.id!==id); save(A_KEY,newArr); renderAttendance(); }

    function clearAttForm(){ $('workerSelect').value=''; $('attRole').value=''; $('attStart').value='09:00'; $('attEnd').value='21:00'; $('attFull').checked=false; const today = new Date().toISOString().slice(0,10); $('attDate').value = today; }

    function esc(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
  </script></body>
</html>
