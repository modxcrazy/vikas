<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Furniture Kaam Dehadi ‚Äî Dark Dashboard</title>
<style>
:root{
  --bg:#121212; --card:#1e1e1e; --accent:#0ea5a4; --accent2:#06b6d4;
  --text:#f5f5f5; --muted:#b0b0b0; --success:#16a34a; --danger:#ef4444; --radius:12px; --shadow:0 4px 20px rgba(0,0,0,0.6);
  font-family:Inter, system-ui, -apple-system,'Segoe UI',Roboto,Arial;
}
*{box-sizing:border-box}
body{margin:0;padding:20px;background:var(--bg);color:var(--text);}
.wrap{max-width:1150px;margin:0 auto;}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.brand h1{margin:0;font-size:22px;color:var(--accent);}
.brand .logo{width:50px;height:50px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:12px;display:flex;justify-content:center;align-items:center;color:#fff;font-weight:700;font-size:20px;box-shadow:var(--shadow);}
.buttons{display:flex;gap:12px}
button{padding:8px 14px;border-radius:10px;border:0;font-weight:600;cursor:pointer;transition:.2s}
button:active{transform:translateY(1px);}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;}
.btn-ghost{background:#2a2a2a;border:1px solid #333;color:var(--text);}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);margin-bottom:18px;transition:.2s;}
.card:hover{transform:translateY(-2px)}
.card-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;}
.card-body{margin-top:10px;display:none;}
.card-body table{width:100%;border-collapse:collapse;font-size:14px;margin-top:8px;color:var(--text)}
th,td{padding:6px;border-bottom:1px solid #333;text-align:left}
th{color:var(--muted)}
.chip{padding:4px 8px;border-radius:999px;font-size:12px;font-weight:600}
.chip.ok{background:rgba(22,163,74,0.2);color:var(--success)}
.chip.warn{background:rgba(255,165,0,0.2);color:#c97b00}
.chip.danger{background:rgba(239,68,68,0.2);color:var(--danger)}
.worker-actions button{margin-left:5px;padding:4px 8px;font-size:12px;}
.toast-wrap{position:fixed;right:20px;bottom:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}
.toast{background:#222;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transform:translateY(8px);transition:all .3s;}
.toast.show{opacity:1;transform:none;}
.modal-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:999;}
.modal{background:var(--card);border-radius:var(--radius);padding:20px;width:350px;max-width:90%;box-shadow:var(--shadow);position:relative;transform:translateY(-20px);opacity:0;transition:all .25s;}
.modal.show{opacity:1;transform:translateY(0);}
.modal h3{margin:0 0 12px 0;color:var(--accent);}
.modal .close{position:absolute;top:10px;right:12px;cursor:pointer;font-weight:700;font-size:18px;color:var(--muted);}
input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #333;background:#2a2a2a;color:#fff;margin-bottom:10px;font-size:14px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">FK</div>
      <h1>Furniture Workers</h1>
    </div>
    <div class="buttons">
      <button class="btn btn-primary" id="btnAddWorker">Add Worker</button>
    </div>
  </header>
  <div id="statsDashboard"></div>
  <div id="workerDashboard"></div>
</div>

<!-- Modal Worker -->
<div class="modal-bg" id="modalWorker">
  <div class="modal">
    <span class="close" id="closeWorker">&times;</span>
    <h3>Register/Edit Worker</h3>
    <input type="hidden" id="wId">
    <input type="text" id="wName" placeholder="Worker Name">
    <input type="text" id="wPhone" placeholder="Phone Number">
    <input type="text" id="wRole" placeholder="Role (Ex: Carpenter)">
    <button class="btn btn-primary" id="saveWorker">Save</button>
  </div>
</div>

<!-- Modal Attendance -->
<div class="modal-bg" id="modalAttendance">
  <div class="modal">
    <span class="close" id="closeAttendance">&times;</span>
    <h3>Add/Edit Attendance</h3>
    <input type="hidden" id="attId">
    <label>Date</label>
    <input type="date" id="attDate">
    <label>Status</label>
    <select id="attStatus">
      <option value="Present">Present</option>
      <option value="Absent">Absent</option>
    </select>
    <label>Start</label>
    <input type="time" id="attStart" value="09:00">
    <label>End</label>
    <input type="time" id="attEnd" value="21:00">
    <label><input type="checkbox" id="attFull"> Full day (12 hrs)</label>
    <div style="margin-top:10px;">
      <button class="btn btn-primary" id="saveAttendance">Save Attendance</button>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toasts"></div>

<script>
const W_KEY='fk_workers',A_KEY='fk_attendance';
const $=id=>document.getElementById(id);
function load(key){return JSON.parse(localStorage.getItem(key)||'[]')}
function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
function toast(msg){const t=document.createElement('div');t.className='toast';t.textContent=msg;$('toasts').appendChild(t);requestAnimationFrame(()=>t.classList.add('show'));setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),320)},2000)}
function showModal(id){$(id).style.display='flex';setTimeout(()=>$(id).querySelector('.modal').classList.add('show'),10)}
function hideModal(id){$(id).querySelector('.modal').classList.remove('show');setTimeout(()=>$(id).style.display='none',250)}

// Modal Worker
$('btnAddWorker').onclick=()=>{ $('wId').value=''; $('wName').value=''; $('wPhone').value=''; $('wRole').value=''; showModal('modalWorker'); }
$('closeWorker').onclick=()=>hideModal('modalWorker');
$('saveWorker').onclick=()=>{
  const id=$('wId').value,name=$('wName').value.trim(),phone=$('wPhone').value.trim(),role=$('wRole').value.trim();
  if(!name||!phone){toast('Name and phone required');return;}
  let arr=load(W_KEY);
  if(id){ // edit
    arr=arr.map(w=>w.id==id?{...w,name,phone,role}:w);
    toast('Worker updated');
  }else{ // add
    if(arr.some(w=>w.phone===phone)){toast('Phone already exists');return;}
    arr.push({id:Date.now(),name,phone,role});
    toast('Worker added');
  }
  save(W_KEY,arr); hideModal('modalWorker'); renderDashboard();
}

// Modal Attendance
$('closeAttendance').onclick=()=>hideModal('modalAttendance');
$('saveAttendance').onclick=()=>{
  const attId=$('attId').value,workerId=$('attWorkerId').value, date=$('attDate').value, status=$('attStatus').value, start=$('attStart').value, end=$('attEnd').value;
  let arr=load(A_KEY);
  if(attId){ arr=arr.map(a=>a.id==attId?{...a,date,status,start,end}:a); toast('Attendance updated'); }
  else{ arr.push({id:Date.now(),workerId, date,status,start,end}); toast('Attendance saved'); }
  save(A_KEY,arr); hideModal('modalAttendance'); renderDashboard();
}
$('attFull').onchange=e=>{if(e.target.checked){$('attStart').value='09:00';$('attEnd').value='21:00'}}

// Render Dashboard
function renderDashboard(){
  const container=$('workerDashboard'); container.innerHTML='';
  const stats=$('statsDashboard'); stats.innerHTML='';
  const workers=load(W_KEY);
  const attendance=load(A_KEY);
  const totalWorkers=workers.length;
  const presentCount=attendance.filter(a=>a.status==='Present').length;
  const absentCount=attendance.filter(a=>a.status==='Absent').length;
  stats.innerHTML=`<div>Total Workers: ${totalWorkers} | Present: ${presentCount} | Absent: ${absentCount}</div>`;

  if(!workers.length){container.innerHTML='<p style="color:var(--muted)">No workers yet.</p>'; return;}
  workers.forEach(w=>{
    const card=document.createElement('div'); card.className='card';
    const workerAttendance = attendance.filter(a=>a.workerId==w.id).sort((a,b)=>b.id-a.id);
    let tableRows='';
    workerAttendance.forEach(a=>{
      const s=parseInt(a.start.split(':')[0])*60+parseInt(a.start.split(':')[1]);
      const e=parseInt(a.end.split(':')[0])*60+parseInt(a.end.split(':')[1]);
      const mins=Math.max(0,e-s);
      const hours=Math.floor(mins/60);
      const minutes=mins%60;
      const hhmm=`${hours}:${minutes.toString().padStart(2,'0')}`;
      const chipClass=mins>=12*60?'ok':mins>=6*60?'warn':'danger';
      tableRows+=`<tr>
        <td>${a.date}</td>
        <td>${a.status}</td>
        <td>${a.start}</td>
        <td>${a.end}</td>
        <td><span class="chip ${chipClass}">${hhmm}</span></td>
        <td>
          <button class="btn btn-ghost" onclick="editAttendance(${a.id},${w.id})">Edit</button>
          <button class="btn btn-ghost" onclick="deleteAttendance(${a.id},${w.id})">Delete</button>
        </td>
      </tr>`;
    });
    card.innerHTML=`
      <div class="card-header">
        <div>
          <strong>${w.name}</strong> ${w.role?'- '+w.role:''}<br>
          <span style="color:var(--muted)">${w.phone}</span>
        </div>
        <div class="worker-actions">
          <button class="btn btn-ghost" onclick="window.location='tel:${w.phone}'">üìû</button>
          <button class="btn btn-ghost" onclick="window.open('https://wa.me/${w.phone}','_blank')">üí¨</button>
          <button class="btn btn-ghost" onclick="editWorker(${w.id})">‚úèÔ∏è</button>
          <button class="btn btn-ghost" onclick="deleteWorker(${w.id})">üóëÔ∏è</button>
          <button class="btn btn-primary" onclick="toggleAttendance(this)">Attendance</button>
        </div>
      </div>
      <div class="card-body">
        ${workerAttendance.length?`<table>
          <thead><tr><th>Date</th><th>Status</th><th>Start</th><th>End</th><th>Hours</th><th>Action</th></tr></thead>
          <tbody>${tableRows}</tbody>
        </table>`:'<p style="color:var(--muted)">No attendance yet.</p>'}
        <button class="btn btn-primary" onclick="addAttendance(${w.id})">Add Attendance</button>
      </div>
    `;
    container.appendChild(card);
  });
}

function toggleAttendance(btn){
  const body = btn.closest('.card').querySelector('.card-body');
  body.style.display = body.style.display==='block'?'none':'block';
}

function addAttendance(workerId){
  $('attId').value=''; $('attWorkerId')?.remove();
  const input=document.createElement('input'); input.type='hidden'; input.id='attWorkerId'; input.value=workerId;
  $('modalAttendance').querySelector('.modal').appendChild(input);
  $('attDate').value=new Date().toISOString().slice(0,10);
  $('attStatus').value='Present'; $('attStart').value='09:00'; $('attEnd').value='21:00'; $('attFull').checked=false;
  showModal('modalAttendance');
}

function editAttendance(attId,workerId){
  const att=load(A_KEY).find(a=>a.id==attId);
  if(!att) return;
  $('attId').value=att.id; $('attWorkerId')?.remove();
  const input=document.createElement('input'); input.type='hidden'; input.id='attWorkerId'; input.value=workerId;
  $('modalAttendance').querySelector('.modal').appendChild(input);
  $('attDate').value=att.date; $('attStatus').value=att.status;
  $('attStart').value=att.start; $('attEnd').value=att.end;
  $('attFull').checked=(att.start==='09:00'&&att.end==='21:00');
  showModal('modalAttendance');
}

function deleteAttendance(attId,workerId){
  if(!confirm('Delete attendance?')) return;
  const arr=load(A_KEY).filter(a=>a.id!==attId); save(A_KEY,arr); toast('Attendance deleted'); renderDashboard();
}

function editWorker(id){
  const w=load(W_KEY).find(w=>w.id==id); if(!w) return;
  $('wId').value=w.id; $('wName').value=w.name; $('wPhone').value=w.phone; $('wRole').value=w.role;
  showModal('modalWorker');
}

function deleteWorker(id){
  if(!confirm('Delete worker?')) return;
  const arr=load(W_KEY).filter(w=>w.id!==id); save(W_KEY,arr);
  const arr2=load(A_KEY).filter(a=>a.workerId!==id); save(A_KEY,arr2);
  toast('Worker deleted'); renderDashboard();
}

renderDashboard();
</script>
</body>
</html>
